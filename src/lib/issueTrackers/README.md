# Issue Tracker Integration

Seamless integration with Jira, GitHub Issues, and Trello for automated bug tracking from test failures.

## Overview

The Issue Tracker Integration feature enables automatic ticket creation for failing tests directly from the Reports interface. When a test fails, users can click "Create Ticket" to automatically generate a fully-populated issue in their preferred tracking system.

## Features

- **Multi-Platform Support**: Integrates with Jira, GitHub Issues, and Trello
- **Auto-Populated Tickets**: Includes test metadata, error logs, stack traces, and screenshot URLs
- **Traceability**: Links tickets back to test results for complete audit trail
- **Secure Configuration**: Stores API credentials locally in browser storage
- **Visual Feedback**: Displays linked tickets with external links in results table
- **Prevents Duplicates**: Shows existing ticket links instead of creating new ones

## Architecture

### Core Components

1. **IssueTrackerService** (`issueTrackerService.ts`)
   - Manages API calls to issue tracking platforms
   - Formats ticket descriptions for each platform
   - Handles authentication and error responses

2. **CreateTicketModal** (`CreateTicketModal.tsx`)
   - UI for configuring tracker credentials
   - Displays test details before ticket creation
   - Shows success/error feedback

3. **TestResultsTable** (`TestResultsTable.tsx`)
   - Enhanced with "Create Ticket" buttons for failed tests
   - Displays linked tickets with external links
   - Manages ticket creation workflow

4. **Database Layer** (`issueLinks.ts`)
   - Stores ticket links in Supabase
   - Provides queries for retrieving linked tickets
   - Tracks statistics by tracker type

### Data Flow

```
Failed Test → Create Ticket Button → CreateTicketModal
    ↓
Configuration Input → IssueTrackerService
    ↓
API Call to Tracker → Ticket Created
    ↓
Link Saved to DB → Display in UI
```

## Usage

### For End Users

1. **Navigate to Reports** page with test results
2. **Locate a failed test** in the TestResultsTable
3. **Click "Create Ticket"** button next to the failed test
4. **Select tracker type** (Jira, GitHub, or Trello)
5. **Enter credentials** for your chosen tracker:
   - **Jira**: Base URL, API Token, Project Key
   - **GitHub**: Personal Access Token, Owner, Repository Name
   - **Trello**: API Key, Token, List ID
6. **Click "Create Ticket"** to generate the issue
7. **View the linked ticket** directly from the results table

### Configuration Details

#### Jira
- **Base URL**: Your Atlassian instance URL (e.g., `https://company.atlassian.net`)
- **API Token**: Generate from Atlassian Account Settings → Security → API Tokens
- **Project Key**: The short key for your project (e.g., `PROJ`)

#### GitHub
- **Token**: Personal Access Token with `repo` scope
  - Generate at: Settings → Developer Settings → Personal Access Tokens
- **Owner**: Username or organization name
- **Repository**: Repository name

#### Trello
- **API Key**: Get from https://trello.com/app-key
- **Token**: Generate token from the same page
- **List ID**: Find in URL when viewing a list, or use Trello API

## Ticket Content

Automatically generated tickets include:

### Test Details
- Test name
- Viewport and size
- Test status
- Duration
- Test suite name
- Target URL
- Test run ID

### Error Information
- Error messages
- Stack traces
- Line and column numbers

### Debugging Assets
- Screenshot URLs (before, after, diff)
- Console logs (up to 10 recent logs)

### Metadata
- Auto-generated labels (automated-test, qa, viewport)
- Priority based on status
- Link back to test report

## Example Ticket Output

### GitHub Issue
```markdown
## Test Failure Details

- **Test Name:** Navigation menu is visible
- **Viewport:** tablet (768x1024)
- **Status:** FAIL
- **Duration:** 945ms
- **Test Suite:** Homepage Tests
- **Target URL:** https://example.com
- **Run ID:** run-1

## Errors

### Error 1

**Message:** Expected element to be visible: .nav-menu

**Location:** Line 45, Column 12

**Stack Trace:**
```
Error: Expected element to be visible
    at Object.<anonymous> (tests/homepage.spec.ts:45:12)
```

## Screenshots

- [BEFORE](https://storage.example.com/screenshot-before.png)
- [AFTER](https://storage.example.com/screenshot-after.png)
- [DIFF](https://storage.example.com/screenshot-diff.png)

---
*This issue was automatically generated by Pathfinder Test Automation*
```

## Database Schema

### test_issue_links Table

```sql
CREATE TABLE test_issue_links (
  id TEXT PRIMARY KEY,
  result_id TEXT NOT NULL,
  ticket_id TEXT NOT NULL,
  tracker_type TEXT CHECK(tracker_type IN ('jira', 'github', 'trello')),
  ticket_url TEXT NOT NULL,
  ticket_key TEXT NOT NULL,
  created_at TEXT NOT NULL,
  FOREIGN KEY (result_id) REFERENCES test_results(id)
);
```

## API Reference

### IssueTrackerService

```typescript
// Initialize service
const service = new IssueTrackerService(config);

// Create ticket
const response = await service.createTicket({
  testName: string,
  viewport: string,
  viewportSize: string,
  status: 'pass' | 'fail' | 'skipped',
  duration?: number,
  errors?: ErrorObject[],
  consoleLogs?: ConsoleLog[],
  screenshots?: Screenshot[],
  testRunId: string,
  testSuiteName: string,
  targetUrl: string,
});

// Test connection
const result = await service.testConnection();
```

### Supabase Helpers

```typescript
// Create link
await createIssueLink(resultId, ticketId, trackerType, ticketUrl, ticketKey);

// Get links for result
const { data } = await getIssueLinksForResult(resultId);

// Get links for run
const { data } = await getIssueLinksForRun(runId);

// Get statistics
const { data } = await getIssueLinkStats();
```

## Security Considerations

- **Credentials Storage**: API tokens stored in browser localStorage
- **HTTPS Required**: All API calls use secure connections
- **No Server-Side Storage**: Credentials never sent to backend
- **Scoped Permissions**: Recommends minimal required permissions for tokens

## Troubleshooting

### Common Issues

**Issue**: "Failed to create ticket"
- **Solution**: Verify API credentials are correct
- **Solution**: Check that project/repository exists
- **Solution**: Ensure token has required permissions

**Issue**: Ticket created but link not showing
- **Solution**: Check browser console for errors
- **Solution**: Verify Supabase connection
- **Solution**: Refresh the page

**Issue**: Duplicate tickets created
- **Solution**: System prevents duplicates by checking existing links
- **Solution**: If duplicate appears, check ticket link storage

## Future Enhancements

- [ ] Support for additional trackers (Linear, Azure DevOps, etc.)
- [ ] Bulk ticket creation for multiple failures
- [ ] Ticket templates and customization
- [ ] Auto-closing tickets when tests pass
- [ ] Bi-directional sync (update test results from ticket status)
- [ ] Team collaboration features
- [ ] Webhook notifications

## Contributing

When extending the issue tracker integration:

1. Add new tracker types to `IssueTrackerType` union
2. Implement platform-specific methods in `IssueTrackerService`
3. Add configuration fields to `CreateTicketModal`
4. Update formatting methods for platform-specific markdown
5. Add test connection logic
6. Update documentation

## License

Part of Pathfinder Test Automation Platform
